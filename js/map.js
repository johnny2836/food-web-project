var vendor = [
  {
    last: 4,
    pricePre: "$100-200",
    price: "$50-100",
    vendorName: "一之軒京站店",
    time: "明日 19:00-20:00",
    score: 4.5,
    distance: "1.5",
    pic: "ijysheng.jpg",
    join: "Sun Nov 28 2021 12:00:00 GMT+0800",
  },
  {
    last: 3,
    pricePre: "$190",
    price: "$100",
    vendorName: "牛有廖",
    time: "明日 19:30-20:30",
    score: 4.3,
    distance: "1.0",
    pic: "beefull.jpg",
    join: "Sun Nov 28 2021 12:00:00 GMT+0800",
  },
  {
    last: 4,
    pricePre: "$240",
    price: "$100",
    vendorName: "良作廚房",
    time: "明日 12:30-13:30",
    score: 4.0,
    distance: "0.6",
    pic: "fresh_bowl.jpeg",
    join: "Sun Nov 28 2021 12:00:00 GMT+0800",
  },
  {
    last: 3,
    pricePre: "$310",
    price: "$150",
    vendorName: "Le Flam 樂芙坊",
    time: "明日 20:00-21:00",
    score: 4.8,
    distance: "2.4",
    pic: "Le_Flam.jpg",
    join: "Sun Nov 28 2021 12:00:00 GMT+0800",
  },
  {
    last: 1,
    pricePre: "$220",
    price: "$110",
    vendorName: "飛翔南洋料理",
    time: "明日 20:00-21:30",
    score: 4.2,
    distance: "1.3",
    pic: "Toko_indo_feifei.jpg",
    join: "Sun Nov 28 2021 12:00:00 GMT+0800",
  },
  {
    last: 4,
    pricePre: "$95",
    price: "$50",
    vendorName: "小木屋鬆餅",
    time: "明日 19:00-20:00",
    score: 4.5,
    distance: "2.5",
    pic: "shinemood.jpg",
    join: "Sun Nov 28 2021 12:00:00 GMT+0800",
  },
  {
    last: 2,
    pricePre: "$175",
    price: "$80",
    vendorName: "LANO食堂",
    time: "明日 13:00-14:00",
    score: 4.3,
    distance: "1.6",
    pic: "lano.jpg",
    join: "Sun Nov 28 2021 12:00:00 GMT+0800",
  },
  {
    last: 1,
    pricePre: "$360",
    price: "$180",
    vendorName: "順億鮪魚專賣店",
    time: "明日 20:00-21:30",
    score: 4.2,
    distance: "1.8",
    pic: "soonyi.jpg",
    join: "Sun Nov 28 2021 12:00:00 GMT+0800",
  },
  {
    last: 1,
    pricePre: "$240",
    price: "$120",
    vendorName: "低卡健康廚房",
    time: "明日 14:00-15:00",
    score: 4.0,
    distance: "2.8",
    pic: "green_table.jpeg",
    join: "Sun Nov 28 2021 12:00:00 GMT+0800",
  },
  {
    last: 4,
    pricePre: "$105",
    price: "$50",
    vendorName: "溫德德式烘焙餐館",
    time: "明日 19:30-20:30",
    score: 4.1,
    distance: "0.4",
    pic: "wendel_s_german_bakery_Bistro.jpg",
    join: "Sun Nov 28 2021 12:00:00 GMT+0800",
  },
  {
    last: 3,
    pricePre: "$120",
    price: "$60",
    vendorName: "哈肯舖手感烘焙",
    time: "明日 20:00-21:00",
    score: 4.7,
    distance: "2.1",
    pic: "hoganbakery.jpg",
    join: "Sun Nov 28 2021 12:00:00 GMT+0800",
  },
  {
    last: 3,
    pricePre: "$200",
    price: "$100",
    vendorName: "泰嗨 健康餐盒",
    time: "明日 20:00-21:30",
    score: 4.2,
    distance: "0.7",
    pic: "thai_high.jpeg",
    join: "Sun Nov 28 2021 12:00:00 GMT+0800",
  },
  {
    last: 1,
    pricePre: "$110",
    price: "$55",
    vendorName: "昀昀甜點",
    time: "明日 20:00-21:00",
    score: 4.4,
    distance: "1.9",
    pic: "yun_yun_patisserie.jpg",
    join: "Sun Nov 28 2021 12:00:00 GMT+0800",
  },
  {
    last: 5,
    pricePre: "$360",
    price: "$180",
    vendorName: "FOOD GYM 附近餐飲",
    time: "明日 20:30-22:00",
    score: 4.1,
    distance: "3.6",
    pic: "food_gym.jpg",
    join: "Sun Nov 27 2022 12:00:00 GMT+0800",
  },
  {
    last: 3,
    pricePre: "$200",
    price: "$100",
    vendorName: "不萊梅義大利麵",
    time: "明日 20:30-22:00",
    score: 4.4,
    distance: "0.3",
    pic: "bremen.jpg",
    join: "Sun Nov 28 2021 12:00:00 GMT+0800",
  },
  {
    last: 4,
    pricePre: "$248",
    price: "$120",
    vendorName: "Body Fit 健康盒",
    time: "明日 13:30-14:30",
    score: 4.0,
    distance: "2.2",
    pic: "body_fit.jpg",
    join: "Sun Nov 27 2022 12:00:00 GMT+0800",
  },
  {
    last: 3,
    pricePre: "$110",
    price: "$50",
    vendorName: "粥師傅廣東粥",
    time: "明日 21:00-22:00",
    score: 4.1,
    distance: "1.6",
    pic: "Master_Congee_s_Cantonese_Congee.jpg",
    join: "Sun Nov 27 2022 12:00:00 GMT+0800",
  },
  {
    last: 3,
    pricePre: "$100-180",
    price: "$50-90",
    vendorName: "揪好廚房",
    time: "明日 20:00-21:00",
    score: 4.6,
    distance: 3.4,
    pic: "jo_s_bon_kitchen.jpg",
    join: "Sun Nov 28 2021 12:00:00 GMT+0800",
  },
  {
    last: 4,
    pricePre: "$125",
    price: "$60",
    vendorName: "捌月肆日甜點坊",
    time: "明日 19:30-21:00",
    score: 4.3,
    distance: "2.8",
    pic: "august_fourth_pâtisserie.jpg",
    join: "Sun Nov 27 2022 12:00:00 GMT+0800",
  },
  {
    last: 4,
    pricePre: "$220-340",
    price: "$110-170",
    vendorName: "無麩質健康餐盒",
    time: "明日 13:30-14:30",
    score: 4.0,
    distance: "1.7",
    pic: "sunflower.jpeg",
    join: "Sun Nov 27 2022 12:00:00 GMT+0800",
  },
  {
    last: 3,
    pricePre: "$99",
    price: "$50",
    vendorName: "丹堤咖啡",
    time: "明日 09:00-10:30",
    score: 4.4,
    distance: "0.2",
    pic: "dante_coffee.jpg",
    join: "Sun Nov 28 2021 12:00:00 GMT+0800",
  },
  {
    last: 1,
    pricePre: "$240",
    price: "$120",
    vendorName: "Hala Chicken",
    time: "明日 16:00-17:00",
    score: 4.3,
    distance: "2.9",
    pic: "hala_chicken.jpg",
    join: "Sun Nov 28 2021 12:00:00 GMT+0800",
  },
  {
    last: 4,
    pricePre: "$95-398",
    price: "$50-180",
    vendorName: "福利麵包",
    time: "明日 19:30-20:30",
    score: 4.4,
    distance: "1.0",
    pic: "florida_bakery.jpg",
    join: "Sun Nov 28 2021 12:00:00 GMT+0800",
  },
  {
    last: 3,
    pricePre: "$212",
    price: "$100",
    vendorName: "金菊雞肉飯",
    time: "明日 20:00-21:30",
    score: 4.6,
    distance: "2.0",
    pic: "jinju_hainanse_chicken_rice.jpg",
    join: "Sun Nov 28 2021 12:00:00 GMT+0800",
  },
  {
    last: 3,
    pricePre: "$130",
    price: "$70",
    vendorName: "摩德年代",
    time: "明日 19:00-20:00",
    score: 4.7,
    distance: "1.1",
    pic: "Modism_Café.jpeg",
    join: "Sun Nov 28 2021 12:00:00 GMT+0800",
  },
  {
    last: 2,
    pricePre: "$450",
    price: "$220",
    vendorName: "義瑪卡多",
    time: "明日 19:30-20:30",
    score: 4.1,
    distance: "3.7",
    pic: "IL_MERCATO.jpg",
    join: "Sun Nov 28 2021 12:00:00 GMT+0800",
  },
  {
    last: 3,
    pricePre: "$110",
    price: "$50",
    vendorName: "露特西亞",
    time: "明日 19:30-20:30",
    score: 4.5,
    distance: "2.5",
    pic: "lutetia.jpg",
    join: "Sun Nov 28 2021 12:00:00 GMT+0800",
  },
  {
    last: 1,
    pricePre: "$300",
    price: "$150",
    vendorName: "歐奇窯烤披薩",
    time: "明日 20:00-21:00",
    score: 4.3,
    distance: "3.0",
    pic: "OGGI.jpeg",
    join: "Sun Nov 28 2021 12:00:00 GMT+0800",
  },
  {
    last: 4,
    pricePre: "$230",
    price: "$110",
    vendorName: "佐藤精肉店 豚丼專門",
    time: "明日 20:00-21:30",
    score: 4.0,
    distance: "1.4",
    pic: "Sato_Seinikuten_Shilin.jpg",
    join: "Sun Nov 27 2022 12:00:00 GMT+0800",
  },
  {
    last: 3,
    pricePre: "$170",
    price: "$80",
    vendorName: "紅gimbap飯捲",
    time: "明日 20:00-21:00",
    score: 4.2,
    distance: "0.6",
    pic: "honggimbap.jpg",
    join: "Sun Nov 28 2021 12:00:00 GMT+0800",
  },
  {
    last: 3,
    pricePre: "$420",
    price: "$200",
    vendorName: "微巷義大利小餐館",
    time: "明日 20:30-21:30",
    score: 4.3,
    distance: "1.7",
    pic: "vicolo_trattoria.jpeg",
    join: "Sun Nov 27 2022 12:00:00 GMT+0800",
  },
  {
    last: 4,
    pricePre: "$75",
    price: "$40",
    vendorName: "好好食光",
    time: "明日 13:30-14:30",
    score: 4.2,
    distance: "2.1",
    pic: "goodbagelxtea.jpeg",
    join: "Sun Nov 27 2022 12:00:00 GMT+0800",
  },
];

// 產品
var product = [
  {
    vendorName: "一之軒京站店",
    productName: "麵包福袋",
    describe: "三明治、雜糧麵包等",
    price: 50,
    qty: 3,
    time: "明日 19:00-20:00",
    content: "3-4個美味麵包",
    pic: "ijysheng-cranberry-cheese-bread.jpeg",
  },
  {
    vendorName: "一之軒京站店",
    productName: "蛋糕福袋",
    describe: "蛋糕、甜點等",
    price: 100,
    qty: 1,
    time: "明日 19:00-20:00",
    content: "3-4個美味蛋糕",
    pic: "ijysheng-honey-cake.jpg",
  },
  {
    vendorName: "溫德德式烘焙餐館",
    productName: "麵包福袋",
    describe: "麵包、吐司等",
    price: 50,
    qty: 2,
    time: "明日 19:30-20:30",
    content: "2-3個烘焙麵包",
    pic: "wendel_s_german_bakery_Bistro-honey-bread.jpg",
  },
  {
    vendorName: "小木屋鬆餅",
    productName: "鬆餅福袋",
    describe: "甜餅或鹹餅",
    price: 50,
    qty: 1,
    time: "明日 19:00-20:00",
    content: "1份美味鬆餅",
    pic: "shinemood-fried-chicken-waffle.jpg",
  },
  {
    vendorName: "哈肯舖手感烘焙",
    productName: "麵包福袋",
    describe: "麵包、吐司、貝果等",
    price: 60,
    qty: 2,
    time: "明日 19:30-20:30",
    content: "3-4個烘焙麵包",
    pic: "hoganbakery-japanese-bread.jpg",
  },
  {
    vendorName: "福利麵包",
    productName: "麵包福袋",
    describe: "麵包、漢堡、吐司等",
    price: 60,
    qty: 2,
    time: "明日 19:30-20:30",
    content: "2-3個烘焙麵包",
    pic: "florida_bakery-garlic-cream-bread.jpg",
  },
];

// 要求使用者的權限
let center = [25.0418915, 121.525618]; //初始座標
//要求位置權限
// 允許要求
function successGPS(position) {
  const lat = position.coords.latitude;
  const lng = position.coords.longitude;
  center = [lat, lng];
  triggerLeaflet();
}
// 拒絕要求
function errorGPS() {
  window.alert(
    "無法判斷您的所在位置，無法使用此功能。預設地點將為 國立台北商業大學"
  );
  triggerLeaflet();
}
// 無法使用GPS
if (navigator.geolocation) {
  navigator.geolocation.getCurrentPosition(successGPS, errorGPS);
} else {
  window.alert("您的裝置不具備GPS，無法使用此功能");
  triggerLeaflet();
}

// 地圖JS
function triggerLeaflet() {
  let zoom = 17; // 0-18
  let map = L.map("map").setView(center, zoom);
  L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
    attribution:
      "© OpenStreetMap<a style='margin= 30px;'>常見問題</a><a>服務條款</a><a>隱私政策</a>", // 商用時必須要有版權出處
    zoomControl: true, // 是否秀出 - + 按鈕
  }).addTo(map);
  // 使用者位置ICON
  var customIcon = L.icon({
    iconUrl:
      "https://cdn4.iconfinder.com/data/icons/universal-7/614/17_-_Location-256.png",
    iconSize: [45, 45],
  });
  const marker = L.marker(center, {
    // icon: customIcon,
    // title: "跟 <a> 的 title 一樣", // 跟 <a> 的 title 一樣
    opacity: 1.0,
  }).addTo(map);

  // 店家位置ICON
  var greenIcon = new L.Icon({
    iconUrl:
      "https://cdn.rawgit.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-green.png",
    shadowUrl:
      "https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png",
    iconSize: [25, 41],
    iconAnchor: [12, 41],
    popupAnchor: [1, -34],
    shadowSize: [41, 41],
  });
  var redIcon = new L.Icon({
    iconUrl:
      "https://cdn.rawgit.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-red.png",
    shadowUrl:
      "https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png",
    iconSize: [25, 41],
    iconAnchor: [12, 41],
    popupAnchor: [1, -34],
    shadowSize: [41, 41],
  });
  var greyIcon = new L.Icon({
    iconUrl:
      "https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-grey.png",
    shadowUrl:
      "https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png",
    iconSize: [25, 41],
    iconAnchor: [12, 41],
    popupAnchor: [1, -34],
    shadowSize: [41, 41],
  });
  for (let i = 0; i < vendor.length; i++) {
    let vendorName = vendor[i].vendorName;
    let last = vendor[i].last;
    let pic = vendor[i].pic;
    console.log(vendor.length);
  }
  function getRandom(min, max) {
    return Math.floor(Math.random() * (max - min + 1)) + min;
  }
  var markers = new L.MarkerClusterGroup().addTo(map);

  var xhr = new XMLHttpRequest();
  xhr.open(
    "get",
    "https://raw.githubusercontent.com/kiang/pharmacies/master/json/points.json"
  );
  xhr.send();
  xhr.onload = function () {
    var data = JSON.parse(xhr.responseText).features;
    for (let i = 0; data.length > i; i++) {
      var mask;
      var test = getRandom(0, 32);
      var random = getRandom(0, 5);
      if (random == 0) {
        mask = greyIcon;
      } else if (random >= 3) {
        mask = greenIcon;
      } else {
        mask = redIcon;
      }
      var a = Number(data[i].geometry.coordinates[1]),
        b = Number(data[i].geometry.coordinates[0]);

      markers.addLayer(
        L.marker([a, b], { icon: mask }).bindPopup(
          '<div class="map_div"><img src="./img/素材/img/' +
            vendor[random].pic +
            '" alt="" style="object-fit: cover" class="map_img" ><p class="map_store">' +
            vendor[random].vendorName +
            '</p> <span class="list_time">剩餘數量: ' +
            vendor[random].last +
            "</span></div>"
        )
      );
      // add more markers here...
      // L.marker().addTo(map)
      //   )
    }
    map.addLayer(markers);
  };
}

let favorite = document.querySelector(".favorite");

let favorite_change = () => {
  favorite.classList.toggle("unfavorite");
};

let heart = document.querySelectorAll(".heart");

let heart_change0 = () => {
  heart[0].classList.toggle("heart_full");
};
let heart_change1 = () => {
  heart[1].classList.toggle("heart_full");
};
let heart_change2 = () => {
  heart[2].classList.toggle("heart_full");
};
let heart_change3 = () => {
  heart[3].classList.toggle("heart_full");
};
let heart_change4 = () => {
  heart[4].classList.toggle("heart_full");
};
let heart_change5 = () => {
  heart[5].classList.toggle("heart_full");
};
let heart_change6 = () => {
  heart[6].classList.toggle("heart_full");
};
let heart_change7 = () => {
  heart[7].classList.toggle("heart_full");
};
let heart_change8 = () => {
  heart[8].classList.toggle("heart_full");
};

var swiper = new Swiper(".Swiper", {
  slidesPerView: 4,
  spaceBetween: 24,
  slidesPerGroup: 1,

  navigation: {
    nextEl: ".next_button",
    prevEl: ".back_button",
    disabledClass: "my-button-disabled",
  },
});
